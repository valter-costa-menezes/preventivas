{% extends "maquinas/nav.html" %}


{% load static %}

{% block content %}
    <!DOCTYPE html>
    <html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Página inicial</title>   
      
        <link rel="stylesheet" type="text/css" href="{% static '/css/index.css' %}">

    </head>
    <style>

    </style>

    <body>

        <div>
            <label for="filtro-maquina">Filtrar pelo número da máquina:</label>
            <input type="text" id="filtro-maquina" placeholder="Busca por máquina">
        </div>

        <div class="tabela">
            <table id="tabela-maquinas">
                   
                    <tr>
                        <th>Máquinas</th>
                        <th>Horimetro atual</th>
                        <th>Modelo</th>
                        <th>Preventiva 1</th>
                        <th>Proxima preventiva</th>
                        <th>Preventiva 2</th>
                        <th>Proxima preventiva</th>
                        <th>Preventiva 3</th>
                        <th>Proxima preventiva</th>
                        <th>Histórico</th>

                    </tr>
                    {% for maquina in maquinas %}
                    <tr>
                        <td>
                            {{maquina.frota}}
                            <span class="notification-dot" data-maquina-id="{{maquina.id}}"></span>     
                        </td>
                        <td class="horimetro_atual">{{maquina.horimetro |default:"-"}}</td>
                        <td>{{maquina.modelo}}</td>
                        <td> {{maquina.hora1}}</td>
                        <td class="primeira_preventiva">{{maquina.hora1 |add:maquina.Primeira}}</td>
                        <td> {{maquina.hora2}}</td>
                        <td class="segunda_preventiva">{{maquina.hora2 |add:maquina.Segunda}}</td>
                        <td> {{maquina.hora3|default:"-"}}</td>
                        <td class="terceira_preventiva">{{maquina.hora3 |add:maquina.Terceira|default:"-"}}</td>

                 

                        <td class="salvar"> 
                            <a href="{% url 'atualizarHor' maq_id=maquina.id %}"><button class="btn_salvar">&#9874;</button></a> 
                            
                        </td>
                    </tr>
                    {% endfor %}
            
                </table>
            </div>


    </body>
    <Script>
        // PONTO DE NOTIFICAÇÃO
        var hr = document.querySelectorAll('.horimetro_atual')
        var pr = document.querySelectorAll('.primeira_preventiva')
        var sg = document.querySelectorAll('.segunda_preventiva')
        var tr = document.querySelectorAll('.terceira_preventiva')


        for(let i = 0; i < hr.length; i++){
            var horimetro = parseInt(hr[i].textContent, 10)
            var primeira = parseInt(pr[i].textContent, 10)
            var segunda = parseInt(sg[i].textContent, 10)  
            var terceira = parseInt(tr[i].textContent, 10) 

            if (isNaN(horimetro)) continue;
           
            if(horimetro >= terceira){
                // tr[i].style.backgroundColor = 'red';
                // hr[i].style.backgroundColor = 'red';       
                document.querySelectorAll('.notification-dot')[i].style.display = 'inline-block';
            }else if(horimetro >= segunda){
                // sg[i].style.backgroundColor = 'red';       
                // hr[i].style.backgroundColor = 'red';       
                document.querySelectorAll('.notification-dot')[i].style.display = 'inline-block';
            }else if(horimetro >= primeira){
                // pr[i].style.backgroundColor = 'red';       
                // hr[i].style.backgroundColor = 'red';    
                document.querySelectorAll('.notification-dot')[i].style.display = 'inline-block';
   
            }
        }



        //FILTRO DE MÁQUINAS
        document.getElementById('filtro-maquina').addEventListener('input', function(){
            var input = this.value.toLowerCase();
            var linhas = document.querySelectorAll('#tabela-maquinas tr');

            linhas.forEach(function(linhas, index){
                if(index === 0) return; 

                var frota = linhas.cells[0].textContent.toLowerCase();

                if(frota.includes(input)){
                    linhas.style.display = ''
                }else{
                    linhas.style.display = 'none'
                }
            })
        })
    </Script>
    </html>

{% endblock content %}

